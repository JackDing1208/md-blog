# 浏览器输入URL后发生了什么？

### 解析补全url

有些浏览器支持url的搜索功能，浏览器会根据规则判断用户输入的内容，如果是搜索内容，则会和默认的搜索引擎拼接成新的url，如果是网址，则根据url标准将url补全，然后进行DNS域名解析

### DNS域名解析

浏览器会根据url首先通过各种本地的缓存查找对应的IP地址，本地未找到再向DNS服务器查询，查询到IP地址都开始建立TCP连接

### 建立TCP连接

#### 三次握手

![img](https://pic1.zhimg.com/v2-9eec897f8207ae23289229502938bea0_b.jpg)

1. 客户端向服务器发送SYN报文，数据为x，表明申请建立连接

2. 服务端收到SYN报文后，将SYN数据设为x+1，将ACK报文设为y，并返回SYN+ACK报文，表明同意建立连接

3. 客户端收到ACK报文后，将ACK报文数据设为y+1，并将ACK返回服务器，表明收到服务端同意的消息

   **本质是为了确认双方能接收并发送对方的数据包**

### 发送HTTP请求

服务器收到HTTP请求后会根据请求内容返回HTTP响应，此时一般为GET请求，请求的数据类型为HTML

### 服务器处理HTTP请求

服务器收到HTTP请求后会根据请求方法、路径、参数等返回HTTP响应

### 收到HTTP响应

### 关闭TCP连接

#### 四次挥手

![img](https://pic3.zhimg.com/v2-1e480290f059ab57cf57aac6c1249a7e_b.jpg)

1. 客户端向服务器发送FIN报文，数据为x，表明自己数据发送完毕，申请断开连接
2. 服务器收到FIN报文后，将数据x+1返回ACK报文，表明同意断开连接
3. 服务器向客户端发送FIN报文，数据为y，表明自己数据也发送完毕，申请断开连接
4. 客户端收到FIN报文后，将数据y+1返回ACK报文，表明同意断开连接

### 浏览器解析HTML

浏览器通过解析HTML，生成DOM树，解析CSS，生成CSS规则树，然后通过DOM树和CSS规则树生成渲染树。渲染树与DOM树不同，渲染树中并没有head、display为none等不必显示的节点。

遇到解析script标签中的JavaScript脚本时，会阻塞后面的HTML解析，因此script标签一般放到最后。

### 浏览器渲染HTML

根据渲染树布局，计算CSS样式，即每个节点在页面中的大小和位置等几何信息。HTML默认是流式布局的，CSS和js会打破这种布局，改变DOM的外观样式以及大小和位置引起重排和重绘。

> #### Reflow （重排）
>
> 当涉及到DOM节点的**布局属性**发生变化时，就会重新计算该属性，浏览器会重新描绘相应的元素，此过程叫 **回流**（Reflow）。
>
> #### Repaint（重绘）
>
> 当影响DOM元素可见性的属性发生变化 (如 color) 时, 浏览器会重新描绘相应的元素, 此过程称为 **重绘**（Repaint)。因此重排必然会引起重绘。

最后浏览器绘制各个节点，将页面展示给用户。

